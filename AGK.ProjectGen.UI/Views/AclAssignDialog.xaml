<Window x:Class="AGK.ProjectGen.UI.Views.AclAssignDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ðŸ” ÐÐ°Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°" Height="700" Width="650"
        WindowStartupLocation="CenterOwner"
        Background="{StaticResource BgPrimaryBrush}">
    
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð°Ð² Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°" Style="{StaticResource H2Style}"/>
            <TextBlock Style="{StaticResource LabelStyle}" Margin="0,4,0,0">
                <Run Text="ÐŸÐ°Ð¿ÐºÐ°: "/>
                <Run Text="{Binding NodeName}" FontWeight="SemiBold"/>
            </TextBlock>
        </StackPanel>
        
        <!-- Auto-Generated Rules from Profile (read-only) -->
        <Border Grid.Row="1" Background="#E8F5E9" CornerRadius="8" Padding="12" Margin="0,0,0,12">
            <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Visibility" Value="{Binding AutoGeneratedRules.Count, Converter={StaticResource CountToVisibilityConverter}}"/>
                    </Style>
            </Border.Style>
            <DockPanel>
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,8">
                    <TextBlock Text="âš¡" FontSize="14" Margin="0,0,8,0"/>
                    <TextBlock Text="ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° (Ð¸Ð· Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ñ):" Style="{StaticResource H3Style}"/>
                </StackPanel>
                <DataGrid ItemsSource="{Binding AutoGeneratedRules}" 
                          AutoGenerateColumns="False" IsReadOnly="True"
                          CanUserAddRows="False" Background="White" 
                          GridLinesVisibility="Horizontal" RowHeight="32"
                          MaxHeight="120">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Ð¡ÑƒÐ±ÑŠÐµÐºÑ‚" Binding="{Binding Identity}" Width="*"/>
                        <DataGridTextColumn Header="ÐŸÑ€Ð°Ð²Ð°" Binding="{Binding Rights}" Width="100"/>
                        <DataGridTextColumn Header="Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº" Binding="{Binding Competence}" Width="120"/>
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </Border>
        
        <!-- Assigned Rules List -->
        <Border Grid.Row="2" Background="{StaticResource BgSecondaryBrush}" CornerRadius="8" Padding="12" Margin="0,0,0,16">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top" Text="ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ñ€Ð°Ð²Ð°:" Style="{StaticResource H3Style}" Margin="0,0,0,8"/>
                
                <DataGrid ItemsSource="{Binding AssignedRules}" 
                          SelectedItem="{Binding SelectedAssignedRule}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          Background="White"
                          GridLinesVisibility="Horizontal"
                          RowHeight="36"
                          MinHeight="100">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Ð¡ÑƒÐ±ÑŠÐµÐºÑ‚" Binding="{Binding Identity}" Width="*"/>
                        <DataGridTextColumn Header="ÐŸÑ€Ð°Ð²Ð°" Binding="{Binding Rights}" Width="100"/>
                        <DataGridCheckBoxColumn Header="Ð—Ð°Ð¿Ñ€ÐµÑ‚" Binding="{Binding IsDeny}" Width="60"/>
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </Border>
        
        <!-- Add Rule Form -->
        <Border Grid.Row="3" Background="{StaticResource BgSecondaryBrush}" CornerRadius="8" Padding="16" Margin="0,0,0,16">
            <StackPanel>
                <TextBlock Text="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð¾" Style="{StaticResource H3Style}" Margin="0,0,0,12"/>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Principal Selection -->
                    <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,8,8">
                        <TextBlock Text="Ð“Ñ€ÑƒÐ¿Ð¿Ð°/ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ:" Style="{StaticResource LabelStyle}" Margin="0,0,0,4"/>
                        <ComboBox ItemsSource="{Binding AvailablePrincipals}" 
                                  SelectedItem="{Binding SelectedPrincipal}"
                                  DisplayMemberPath="FullName"
                                  Style="{StaticResource ModernComboBoxStyle}"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Row="0" Grid.Column="1" Margin="8,0,0,8">
                        <TextBlock Text="Ð˜Ð»Ð¸ Ð²Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ:" Style="{StaticResource LabelStyle}" Margin="0,0,0,4"/>
                        <TextBox Text="{Binding CustomPrincipalName, UpdateSourceTrigger=PropertyChanged}" 
                                 Style="{StaticResource ModernTextBoxStyle}"
                                 ToolTip="DOMAIN\UserName Ð¸Ð»Ð¸ Ð¸Ð¼Ñ"/>
                    </StackPanel>
                    
                    <!-- Rights Checkboxes -->
                    <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Margin="0,0,0,8">
                        <TextBlock Text="ÐŸÑ€Ð°Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°:" Style="{StaticResource LabelStyle}" Margin="0,0,0,4"/>
                        <WrapPanel>
                            <CheckBox Content="Ð§Ñ‚ÐµÐ½Ð¸Ðµ" IsChecked="{Binding HasRead}" Margin="0,0,16,0"/>
                            <CheckBox Content="Ð—Ð°Ð¿Ð¸ÑÑŒ" IsChecked="{Binding HasWrite}" Margin="0,0,16,0"/>
                            <CheckBox Content="Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ" IsChecked="{Binding HasModify}" Margin="0,0,16,0"/>
                            <CheckBox Content="ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿" IsChecked="{Binding HasFullControl}" Margin="0,0,16,0"/>
                        </WrapPanel>
                    </StackPanel>
                    
                    <!-- Options -->
                    <StackPanel Grid.Row="2" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,0,0,12">
                        <CheckBox Content="Ð—Ð°Ð¿Ñ€ÐµÑ‚Ð¸Ñ‚ÑŒ (Deny)" IsChecked="{Binding IsDeny}" Margin="0,0,24,0"/>
                        <CheckBox Content="ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ðº Ð´Ð¾Ñ‡ÐµÑ€Ð½Ð¸Ð¼ Ð¿Ð°Ð¿ÐºÐ°Ð¼" IsChecked="{Binding ApplyToChildren}"/>
                    </StackPanel>
                    
                    <!-- Add/Remove Buttons -->
                    <StackPanel Grid.Row="3" Grid.ColumnSpan="2" Orientation="Horizontal">
                        <Button Content="âž• Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð¾" Padding="14,8" 
                                Style="{StaticResource SecondaryButtonStyle}" 
                                Command="{Binding AddRuleCommand}"/>
                        <Button Content="ðŸ—‘ï¸ Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ðµ" Padding="14,8" Margin="8,0,0,0"
                                Style="{StaticResource SecondaryButtonStyle}" 
                                Command="{Binding RemoveRuleCommand}"/>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </Border>
        
        <!-- Footer -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="ÐžÑ‚Ð¼ÐµÐ½Ð°" Padding="20,10" Style="{StaticResource SecondaryButtonStyle}" 
                    IsCancel="True" Click="Cancel_Click"/>
            <Button Content="âœ… ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ" Padding="20,10" Margin="12,0,0,0" 
                    Style="{StaticResource PrimaryButtonStyle}" Click="Apply_Click"/>
        </StackPanel>
    </Grid>
</Window>
