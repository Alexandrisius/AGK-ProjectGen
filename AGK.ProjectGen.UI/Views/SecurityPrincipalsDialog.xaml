<Window x:Class="AGK.ProjectGen.UI.Views.SecurityPrincipalsDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ðŸ‘¥ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð³Ñ€ÑƒÐ¿Ð¿Ð°Ð¼Ð¸ Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼Ð¸" Height="700" Width="1000"
        WindowStartupLocation="CenterOwner"
        Background="{StaticResource BgPrimaryBrush}">
    
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="Ð“Ñ€ÑƒÐ¿Ð¿Ñ‹ Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ Ð´Ð»Ñ ACL" Style="{StaticResource H2Style}"/>
            <TextBlock Text="Ð£Ð¿Ñ€Ð°Ð²Ð»ÑÐ¹Ñ‚Ðµ ÑÐ¿Ð¸ÑÐºÐ¾Ð¼ Ð³Ñ€ÑƒÐ¿Ð¿ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð² Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°Ñ… Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°" 
                       Style="{StaticResource LabelStyle}" Margin="0,4,0,0" TextWrapping="Wrap"/>
        </StackPanel>
        
        <!-- Status & Import Buttons -->
        <Border Grid.Row="1" Background="{StaticResource BgSecondaryBrush}" CornerRadius="8" Padding="16" Margin="0,0,0,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0">
                    <TextBlock Text="{Binding DomainStatus}" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding StatusMessage}" Style="{StaticResource LabelStyle}" Margin="0,4,0,0"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="ðŸ”„ Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚ Ð¸Ð· AD" Padding="14,8" 
                            Style="{StaticResource PrimaryButtonStyle}"
                            Command="{Binding ImportFromAdCommand}"
                            ToolTip="Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Ð¸Ð· Active Directory (Ð´Ð¾Ð¼ÐµÐ½)"
                            IsEnabled="{Binding IsAdAvailable}"/>
                    <Button Content="ðŸ’» Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹" Padding="14,8" Margin="8,0,0,0"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Command="{Binding ImportFromLocalCommand}"
                            ToolTip="Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð¼Ð°ÑˆÐ¸Ð½Ñ‹"/>
                    <Button Content="âž• Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ" Padding="14,8" Margin="8,0,0,0"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Command="{Binding AddManualCommand}"
                            ToolTip="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð³Ñ€ÑƒÐ¿Ð¿Ñƒ Ð¸Ð»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Main Content: Two Columns -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Groups List -->
            <Border Grid.Column="0" Background="{StaticResource BgSecondaryBrush}" 
                    CornerRadius="8" Padding="12" Margin="0,0,8,0">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,12">
                        <TextBlock Text="ðŸ‘¥ Ð“Ñ€ÑƒÐ¿Ð¿Ñ‹" Style="{StaticResource H3Style}"/>
                        <TextBlock Text="{Binding Groups.Count, StringFormat=' ({0})'}" 
                                   Style="{StaticResource LabelStyle}" VerticalAlignment="Bottom" Margin="4,0,0,2"/>
                        <Button Content="ðŸ—‘ï¸" Padding="6,4" Margin="12,0,0,0"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Command="{Binding RemoveGroupCommand}"
                                ToolTip="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½ÑƒÑŽ Ð³Ñ€ÑƒÐ¿Ð¿Ñƒ"/>
                    </StackPanel>
                    
                    <DataGrid ItemsSource="{Binding Groups}" 
                              SelectedItem="{Binding SelectedGroup}"
                              Style="{StaticResource ModernDataGridStyle}"
                              RowHeight="40" IsReadOnly="True"
                              AutoGenerateColumns="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Ð˜Ð¼Ñ" Binding="{Binding Name}" Width="*"/>
                            <DataGridTextColumn Header="Ð”Ð¾Ð¼ÐµÐ½" Binding="{Binding Domain}" Width="100"/>
                            <DataGridTextColumn Header="ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ" Binding="{Binding Description}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </Border>
            
            <!-- Users List with Search -->
            <Border Grid.Column="1" Background="{StaticResource BgSecondaryBrush}" 
                    CornerRadius="8" Padding="12" Margin="8,0,0,0">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Margin="0,0,0,12">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="ðŸ‘¤ ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸" Style="{StaticResource H3Style}"/>
                            <TextBlock Text="{Binding Users.Count, StringFormat=' ({0})'}" 
                                       Style="{StaticResource LabelStyle}" VerticalAlignment="Bottom" Margin="4,0,0,2"/>
                            <Button Content="ðŸ—‘ï¸" Padding="6,4" Margin="12,0,0,0"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    Command="{Binding RemoveUserCommand}"
                                    ToolTip="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ"/>
                        </StackPanel>
                        
                        <!-- Search Panel -->
                        <Border Background="{StaticResource BgPrimaryBrush}" CornerRadius="6" Padding="8">
                            <StackPanel>
                                <TextBlock Text="ðŸ” ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹" FontWeight="SemiBold" Margin="0,0,0,6"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Grid.Column="0" 
                                             Text="{Binding UserSearchQuery, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource ModernTextBoxStyle}"
                                             Padding="8,6"
                                             ToolTip="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ‡Ð°ÑÑ‚ÑŒ Ð¸Ð¼ÐµÐ½Ð¸ Ð¸Ð»Ð¸ Ð»Ð¾Ð³Ð¸Ð½Ð° (Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 2 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°)">
                                        <TextBox.InputBindings>
                                            <KeyBinding Key="Enter" Command="{Binding SearchUsersCommand}"/>
                                        </TextBox.InputBindings>
                                    </TextBox>
                                    <Button Grid.Column="1" Content="ðŸ” ÐÐ°Ð¹Ñ‚Ð¸" Padding="12,6" Margin="6,0,0,0"
                                            Style="{StaticResource PrimaryButtonStyle}"
                                            Command="{Binding SearchUsersCommand}"
                                            IsEnabled="{Binding IsSearching, Converter={StaticResource InverseBoolConverter}}"/>
                                </Grid>
                                
                                <!-- Search Results -->
                                <Border Visibility="{Binding SearchResults.Count, Converter={StaticResource CountToVisibilityConverter}}"
                                        BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" 
                                        CornerRadius="4" Margin="0,8,0,0" MaxHeight="150">
                                    <DockPanel>
                                        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="6,6,6,4">
                                            <TextBlock Text="{Binding SearchResults.Count, StringFormat='ÐÐ°Ð¹Ð´ÐµÐ½Ð¾: {0}'}" 
                                                       Style="{StaticResource LabelStyle}"/>
                                            <Button Content="âž• Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ" Padding="8,4" Margin="12,0,0,0"
                                                    Style="{StaticResource PrimaryButtonStyle}"
                                                    Command="{Binding AddFromSearchCommand}"
                                                    ToolTip="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ"/>
                                            <Button Content="âž• Ð’ÑÐµÑ…" Padding="8,4" Margin="6,0,0,0"
                                                    Style="{StaticResource SecondaryButtonStyle}"
                                                    Command="{Binding AddAllFromSearchCommand}"
                                                    ToolTip="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð²ÑÐµÑ… Ð½Ð°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ñ…"/>
                                        </StackPanel>
                                        <ListBox ItemsSource="{Binding SearchResults}"
                                                 SelectedItem="{Binding SelectedSearchResult}"
                                                 MaxHeight="100" Margin="4,0,4,4"
                                                 Background="Transparent"
                                                 BorderThickness="0">
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal" Margin="2">
                                                        <TextBlock Text="{Binding FullName}" FontWeight="SemiBold"/>
                                                        <TextBlock Text="{Binding Description, StringFormat=' â€” {0}'}" 
                                                                   Style="{StaticResource LabelStyle}" Margin="4,0,0,0"/>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>
                                    </DockPanel>
                                </Border>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                    
                    <DataGrid ItemsSource="{Binding Users}" 
                              SelectedItem="{Binding SelectedUser}"
                              Style="{StaticResource ModernDataGridStyle}"
                              RowHeight="40" IsReadOnly="True"
                              AutoGenerateColumns="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Ð˜Ð¼Ñ" Binding="{Binding Name}" Width="*"/>
                            <DataGridTextColumn Header="Ð”Ð¾Ð¼ÐµÐ½" Binding="{Binding Domain}" Width="100"/>
                            <DataGridTextColumn Header="ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ" Binding="{Binding Description}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </Border>
        </Grid>
        
        <!-- Footer -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
            <Button Content="ðŸ“ ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð¸Ð³" Padding="14,10" 
                    Style="{StaticResource SecondaryButtonStyle}"
                    Command="{Binding OpenConfigFileCommand}"
                    ToolTip="ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ñ„Ð°Ð¹Ð» SecurityPrincipals.json Ð² Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€Ðµ"/>
            <Button Content="Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ" Padding="20,10" Margin="12,0,0,0" 
                    Style="{StaticResource SecondaryButtonStyle}" 
                    IsCancel="True" Click="Close_Click"/>
        </StackPanel>
    </Grid>
</Window>
