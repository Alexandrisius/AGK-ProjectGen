<Window x:Class="AGK.ProjectGen.UI.Views.AclPresetDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ðŸ“ ÐŸÑ€ÐµÑÐµÑ‚Ñ‹ ACL" Height="600" Width="900"
        WindowStartupLocation="CenterOwner"
        Background="{StaticResource BgPrimaryBrush}">
    
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€ÐµÑÐµÑ‚Ð°Ð¼Ð¸ ACL" Style="{StaticResource H2Style}"/>
            <TextBlock Text="{Binding Mode}" Style="{StaticResource LabelStyle}" Margin="0,4,0,0"/>
        </StackPanel>
        
        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="340"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Presets List -->
            <Border Grid.Column="0" Background="{StaticResource BgSecondaryBrush}" 
                    CornerRadius="8" Padding="12" Margin="0,0,8,0">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,12">
                        <Button Content="ðŸ—‘ï¸ Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ" Padding="10,6" 
                                Style="{StaticResource SecondaryButtonStyle}" 
                                Command="{Binding DeletePresetCommand}" 
                                ToolTip="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ð¿Ñ€ÐµÑÐµÑ‚"/>
                    </StackPanel>
                    
                    <TextBlock DockPanel.Dock="Top" Text="ÐÐµÑ‚ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½Ð½Ñ‹Ñ… Ð¿Ñ€ÐµÑÐµÑ‚Ð¾Ð²" 
                               Style="{StaticResource LabelStyle}" 
                               HorizontalAlignment="Center" Margin="0,20,0,0"
                               Visibility="{Binding HasNoPresets, Converter={StaticResource BoolToVisibilityConverter}}"/>
                    
                    <ListBox ItemsSource="{Binding Presets}" 
                             SelectedItem="{Binding SelectedPreset}"
                             Style="{StaticResource ModernListBoxStyle}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Margin="4,8">
                                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold" 
                                               TextTrimming="CharacterEllipsis"/>
                                    <TextBlock FontSize="11" Opacity="0.7">
                                        <Run Text="{Binding Rules.Count, Mode=OneWay}"/>
                                        <Run Text=" Ð¿Ñ€Ð°Ð²Ð¸Ð»"/>
                                    </TextBlock>
                                    <TextBlock Text="{Binding Description}" FontSize="11" Opacity="0.5" 
                                               TextTrimming="CharacterEllipsis" MaxWidth="280"
                                               Visibility="{Binding Description, Converter={StaticResource NullToVisibilityConverter}}"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </DockPanel>
            </Border>
            
            <!-- Preset Details / Editor -->
            <Border Grid.Column="1" Background="{StaticResource BgSecondaryBrush}" 
                    CornerRadius="8" Padding="16" Margin="8,0,0,0"
                    Visibility="{Binding SelectedPreset, Converter={StaticResource NullToVisibilityConverter}}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="Ð¡Ð²Ð¾Ð¹ÑÑ‚Ð²Ð° Ð¿Ñ€ÐµÑÐµÑ‚Ð°" Style="{StaticResource H3Style}" Margin="0,0,0,16"/>
                        
                        <!-- Name -->
                        <TextBlock Text="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ" Style="{StaticResource LabelStyle}" Margin="0,0,0,6"/>
                        <TextBox Text="{Binding SelectedPreset.Name, UpdateSourceTrigger=PropertyChanged}" 
                                 Style="{StaticResource ModernTextBoxStyle}" Margin="0,0,0,16"/>
                        
                        <!-- Description -->
                        <TextBlock Text="ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ" Style="{StaticResource LabelStyle}" Margin="0,0,0,6"/>
                        <TextBox Text="{Binding SelectedPreset.Description, UpdateSourceTrigger=PropertyChanged}" 
                                 Style="{StaticResource ModernTextBoxStyle}" 
                                 TextWrapping="Wrap" AcceptsReturn="True"
                                 MinHeight="60" Margin="0,0,0,16"/>
                        
                        <!-- Rules Preview -->
                        <TextBlock Text="ÐŸÑ€Ð°Ð²Ð¸Ð»Ð° Ð² Ð¿Ñ€ÐµÑÐµÑ‚Ðµ" Style="{StaticResource H3Style}" Margin="0,8,0,12"/>
                        
                        <ItemsControl ItemsSource="{Binding SelectedPreset.Rules}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="White" CornerRadius="6" Padding="10" Margin="0,0,0,8">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <StackPanel Grid.Column="0">
                                                <TextBlock FontWeight="SemiBold">
                                                    <Run Text="{Binding PrincipalIdentity}"/>
                                                </TextBlock>
                                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                                    <TextBlock Text="{Binding Rights}" FontSize="12" Opacity="0.7"/>
                                                    <TextBlock Text=" â€¢ " FontSize="12" Opacity="0.5"
                                                               Visibility="{Binding IsDeny, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                                    <TextBlock Text="DENY" FontSize="12" Foreground="#e53935"
                                                               Visibility="{Binding IsDeny, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                                </StackPanel>
                                                <TextBlock Text="{Binding Description}" FontSize="11" Opacity="0.5"
                                                           TextWrapping="Wrap" Margin="0,4,0,0"
                                                           Visibility="{Binding Description, Converter={StaticResource NullToVisibilityConverter}}"/>
                                                
                                                <!-- Conditions -->
                                                <ItemsControl ItemsSource="{Binding Conditions}" Margin="0,6,0,0"
                                                              Visibility="{Binding Conditions.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <TextBlock FontSize="11" Foreground="{StaticResource PrimaryBrush}" Margin="0,2">
                                                                <Run Text="Ð•ÑÐ»Ð¸: "/>
                                                                <Run Text="{Binding AttributePath}"/>
                                                                <Run Text=" "/>
                                                                <Run Text="{Binding Operator}"/>
                                                                <Run Text=" '"/>
                                                                <Run Text="{Binding Value}"/>
                                                                <Run Text="'"/>
                                                            </TextBlock>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                        <!-- Edit Button -->
                        <Button Content="âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°" 
                                Style="{StaticResource SecondaryButtonStyle}"
                                Padding="12,10" Margin="0,16,0,0"
                                Command="{Binding EditPresetRulesCommand}"
                                ToolTip="ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€ Ð´Ð»Ñ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð» Ð¿Ñ€ÐµÑÐµÑ‚Ð°"/>
                        
                        <!-- Save Changes Button -->
                        <Button Content="ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ" 
                                Style="{StaticResource PrimaryButtonStyle}"
                                Padding="12,10" Margin="0,12,0,0"
                                Command="{Binding SavePresetCommand}"
                                ToolTip="Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² Ð¿Ñ€ÐµÑÐµÑ‚Ðµ"/>
                    </StackPanel>
                </ScrollViewer>
            </Border>
            
            <!-- Placeholder -->
            <TextBlock Grid.Column="1" 
                       Text="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ñ€ÐµÑÐµÑ‚ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð¸Ð»Ð¸ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ"
                       Style="{StaticResource LabelStyle}"
                       HorizontalAlignment="Center" VerticalAlignment="Center"
                       Visibility="{Binding SelectedPreset, Converter={StaticResource InverseNullToVisibilityConverter}}"/>
        </Grid>
        
        <!-- Footer -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
            <Button Content="Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ" Padding="20,10" Style="{StaticResource SecondaryButtonStyle}" 
                    IsCancel="True" Click="Close_Click"/>
            <Button Content="ðŸ“¥ Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹" Padding="20,10" Margin="12,0,0,0" 
                    Style="{StaticResource PrimaryButtonStyle}" Click="Load_Click"
                    IsEnabled="{Binding CanLoadPreset}"
                    Visibility="{Binding IsLoadMode, Converter={StaticResource BoolToVisibilityConverter}}"/>
        </StackPanel>
    </Grid>
</Window>
